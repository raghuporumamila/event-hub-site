<button id="chat-toggler" style="position:fixed; bottom:20px; right:20px; padding:15px; border-radius:50%; background:#007bff; color:white; border:none; cursor:pointer; font-size:20px;">
    ðŸ’¬
</button>

<div id="chat-window" style="display:none; position:fixed; bottom:80px; right:20px; width:350px; height:450px; background:white; border:1px solid #ccc; border-radius:10px; flex-direction:column; box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
    <div style="background:#007bff; color:white; padding:10px; border-radius:10px 10px 0 0;">AI Assistant</div>

    <div id="chat-messages" style="flex:1; padding:10px; overflow-y:auto; font-size:14px;">
    </div>

    <div style="padding:10px; border-top:1px solid #eee; display:flex;">
        <input type="text" id="user-input" placeholder="Ask me something..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px;">
        <button id="send-btn" style="margin-left:5px; padding:8px 15px; background:#007bff; color:white; border:none; border-radius:4px; cursor:pointer;">Send</button>
    </div>
</div>
<script language="JavaScript">
    document.getElementById('chat-toggler').onclick = () => {
        const win = document.getElementById('chat-window');
        win.style.display = win.style.display === 'none' ? 'flex' : 'none';
    };

    document.getElementById('send-btn').onclick = async () => {
        const input = document.getElementById('user-input');
        const msgContainer = document.getElementById('chat-messages');
        const text = input.value;
        if (!text) return;

        // 1. Add User Message to UI
        msgContainer.innerHTML += `<div style="text-align:right; margin-bottom:10px;"><span style="background:#e9ecef; padding:5px 10px; border-radius:10px;">${text}</span></div>`;
        input.value = '';

        // 2. Call Spring Boot Backend
        try {
            const response = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ message: text })
            });
            const aiText = await response.text();

            // 3. Add AI Response to UI
            msgContainer.innerHTML += `<div style="margin-bottom:10px;"><span style="background:#007bff; color:white; padding:5px 10px; border-radius:10px;">${aiText}</span></div>`;
            msgContainer.scrollTop = msgContainer.scrollHeight;
        } catch (err) {
            console.error("Failed to reach AI:", err);
        }
    };
</script>